import{a as e,c as t,i as n,l as r,o as i,t as a}from"./BXKdr608ngUESnwh9TJ.js";import{A as o,C as s,D as c,E as l,F as u,H as d,I as f,J as p,K as m,L as h,M as g,N as _,O as v,P as y,R as b,U as ee,V as x,W as S,X as C,Y as te,_ as w,d as T,j as E,k as D,o as O,p as k,q as A,t as ne,u as j,w as M,x as re,y as ie}from"./index-DKeDeMIW.js";import{n as ae,t as oe}from"./KBQiTbN6CMsyITC2uY1.js";import{t as N}from"./BHncciX3sAO02PSaJXe.js";import{a as P,n as F,t as se}from"./BkWEt4jxc2Oj2teMzcr.js";import{t as ce}from"./DGmJRoBZvAIi23e6iwk.js";var I={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-save`,viewBox:`0 0 16 16`};function L(e,t){return h(),E(`svg`,I,[...t[0]||=[v(`path`,{d:`M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1z`},null,-1)]])}var R=L,le={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-x-square`,viewBox:`0 0 16 16`};function z(e,t){return h(),E(`svg`,le,[...t[0]||=[v(`path`,{d:`M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z`},null,-1),v(`path`,{d:`M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708`},null,-1)]])}var B=z,V={class:`input-group`},H=[`value`],U=[`title`],W=[`title`,`disabled`],G=y({__name:`ltLocationInput`,props:{modelValue:{required:!0},modelModifiers:{}},emits:u([`editLocation`],[`update:modelValue`]),setup(e,{emit:t}){let n=/(?<lat>[+-]?\d+\.?\d*)(_(?<ns>[NS]))?[_,;\s]+(?<lng>[+-]?\d+\.?\d*)(_(?<ew>[EW]))?/,r=x(e,`modelValue`),i=t,a=m(r.value?.type),o=m(null);function s(e){if(e===void 0)return;if(!a.value){let e=r.value?.type;e&&(a.value=e)}let t=e.match(n),i=!!t||!e;o.value?.classList?.toggle(`is-invalid`,!i),i&&(r.value=new j(a.value,t?.groups?parseFloat(t.groups.lat)*(t.groups.ns===`S`?-1:1):void 0,t?.groups?parseFloat(t.groups.lng)*(t.groups.ew===`W`?-1:1):void 0,r.value.lat,r.value.lng))}function c(){r.value=r.value?.rollback()}return(e,t)=>(h(),E(`div`,V,[v(`input`,{ref_key:`inputElement`,ref:o,value:r.value.csv,class:`form-control`,type:`text`,onBlur:t[0]||=e=>s(e.target.value),onPaste:t[1]||=e=>{s(e.clipboardData?.getData(`text`)),e.preventDefault()}},null,40,H),v(`button`,{class:`btn btn-outline-secondary`,type:`button`,title:A(T)(`Discard`),onClick:t[2]||=e=>c()},[_(A(B))],8,U),v(`button`,{class:`btn btn-outline-success`,type:`button`,title:A(T)(`Save`),disabled:!r.value?.isChanged,onClick:t[3]||=e=>i(`editLocation`)},[_(A(R))],8,W)]))}}),ue={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-caret-down`,viewBox:`0 0 16 16`};function de(e,t){return h(),E(`svg`,ue,[...t[0]||=[v(`path`,{d:`M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659`},null,-1)]])}var K=de,fe={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-caret-right`,viewBox:`0 0 16 16`};function pe(e,t){return h(),E(`svg`,fe,[...t[0]||=[v(`path`,{d:`M6 12.796V3.204L11.481 8zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753`},null,-1)]])}var q=pe,me={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-camera-fill`,viewBox:`0 0 16 16`};function he(e,t){return h(),E(`svg`,me,[...t[0]||=[v(`path`,{d:`M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0`},null,-1),v(`path`,{d:`M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0`},null,-1)]])}var J=he,ge={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-exclamation-triangle-fill`,viewBox:`0 0 16 16`};function _e(e,t){return h(),E(`svg`,ge,[...t[0]||=[v(`path`,{d:`M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2`},null,-1)]])}var Y=_e,ve={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-house-fill`,viewBox:`0 0 16 16`};function ye(e,t){return h(),E(`svg`,ve,[...t[0]||=[v(`path`,{d:`M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z`},null,-1),v(`path`,{d:`m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z`},null,-1)]])}var X=ye,be={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-question-circle`,viewBox:`0 0 16 16`};function xe(e,t){return h(),E(`svg`,be,[...t[0]||=[v(`path`,{d:`M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16`},null,-1),v(`path`,{d:`M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94`},null,-1)]])}var Z=xe,Se=[`disabled`],Ce={class:`icon-link`},we={key:0},Te={key:1},Ee={class:`card mt-2`},De={class:`card-body p-2`},Oe=[`innerHTML`],ke=[`title`],Ae={class:`card mt-2`},Q={class:`card-body p-2`},je=[`innerHTML`],Me=[`title`],Ne={key:0,class:`alert alert-danger mt-2`},Pe={class:`card mt-2`},Fe={class:`card-header p-2`},Ie={key:0},Le=[`href`],Re={class:`card-body p-2`},ze=y({__name:`ltFileDetails`,props:u({file:{}},{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}}),emits:[`update:coordinates`,`update:objectLocation`],setup(e){let t=x(e,`coordinates`),n=x(e,`objectLocation`),r=e,i=m(void 0),a=m(!1),s=m(!1),u=c(()=>T(`Camera location via
<a href="https://commons.wikimedia.org/wiki/Template:Location" target="_blank"><code class="mediawiki-template">Location</code></a>`)),d=c(()=>T(`Object location via
<a href="https://commons.wikimedia.org/wiki/Template:Object_location" target="_blank"><code class="mediawiki-template">Object location</code></a>`)),f=c(()=>T(`Failed to save: {{$ctrl.error.statusText}}`).replace(`{{$ctrl.error.statusText}}`,i.value?.statusText)),p=c(()=>navigator.platform.toUpperCase().includes(`MAC`)),y=k({passive:!1,onEventFired(e){e.type===`keydown`&&e.key===`s`&&(e.ctrlKey||e.metaKey)&&e.preventDefault()}});w(y[`Ctrl+S`],()=>b()),w(y[`Meta+S`],()=>b());async function b(e){e??=[t.value,n.value].filter(e=>e.isChanged);try{i.value=void 0,await O(r.file,e);for(let r of e)r.type===`Location`?t.value=r.commit():r.type===`Object location`&&(n.value=r.commit())}catch(e){i.value=e}}return(r,c)=>(h(),E(l,null,[v(`button`,{class:`btn btn-success form-control`,type:`button`,disabled:!(t.value?.isChanged||n.value?.isChanged),onClick:c[0]||=e=>b()},[v(`span`,Ce,[_(A(R)),g(` `+C(A(T)(`Save`))+` `,1),p.value?(h(),E(`kbd`,we,`⌘ + S`)):(h(),E(`kbd`,Te,`Ctrl + S`))])],8,Se),v(`div`,Ee,[v(`div`,De,[v(`div`,null,[v(`label`,{class:`icon-link`,onClick:c[1]||=e=>a.value=!a.value},[a.value?(h(),D(A(q),{key:0})):(h(),D(A(K),{key:1})),_(A(J)),v(`span`,{innerHTML:u.value},null,8,Oe),S(v(`abbr`,{title:A(T)(`Left click on map to set the location.`)},[_(A(Z))],8,ke),[[M,!a.value]])]),S(v(`div`,null,[_(G,{modelValue:t.value,"onUpdate:modelValue":c[2]||=e=>t.value=e,onEditLocation:c[3]||=e=>b([t.value])},null,8,[`modelValue`])],512),[[M,!a.value]])])])]),v(`div`,Ae,[v(`div`,Q,[v(`div`,null,[v(`label`,{class:`icon-link`,onClick:c[4]||=e=>s.value=!s.value},[s.value?(h(),D(A(q),{key:0})):(h(),D(A(K),{key:1})),_(A(X)),v(`span`,{innerHTML:d.value},null,8,je),S(v(`abbr`,{title:A(T)(`Press shift and click on map to set the object location.`)},[_(A(Z))],8,Me),[[M,!s.value]])]),S(v(`div`,null,[_(G,{modelValue:n.value,"onUpdate:modelValue":c[5]||=e=>n.value=e,onEditLocation:c[6]||=e=>b([n.value])},null,8,[`modelValue`])],512),[[M,!s.value]])])])]),i.value?(h(),E(`div`,Ne,[_(A(Y),{class:`me-1`}),v(`span`,null,C(f.value),1)])):o(``,!0),v(`div`,Pe,[v(`h5`,Fe,[v(`strong`,null,C(e.file.file),1),c[7]||=g(` `+C(` `)+` `,-1),e.file.url?(h(),E(`small`,Ie,[v(`a`,{href:e.file.url,target:`_blank`},[_(A(P))],8,Le)])):o(``,!0)]),v(`div`,Re,[_(F,{file:e.file},null,8,[`file`])])])],64))}}),$=r(t(),1),Be=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
  <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
  <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
</svg>`,Ve=`/assets/marker-icon-2x-_ZA0WGCc.png`,He=`/assets/marker-icon-hN30_KVU.png`,Ue=`/assets/marker-shadow-f7SaPCxT.png`,We=y({__name:`ltMap`,props:{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}},emits:u([`mapViewChanged`],[`update:coordinates`,`update:objectLocation`]),setup(e){let t=x(e,`coordinates`),n=x(e,`objectLocation`),r=m(null);f(()=>{let{map:e}=N(r);e.on(`click`,e=>a(e)),d(t,i(e),{immediate:!0}),d(n,i(e),{immediate:!0})});function i(e){let t;return n=>{let{lat:r,lng:i}=n;if(n.isDefined&&t)e.setView({lat:r,lng:i}),t.setLatLng({lat:r,lng:i});else if(n.isDefined){e.setView({lat:r,lng:i});let a=n.type===`Location`?new $.Icon({iconRetinaUrl:Ve,iconUrl:He,shadowUrl:Ue,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}):new $.DivIcon({className:`b-0`,html:`<div title="Object location" style="color: red">${Be}</div>`,iconAnchor:[6,6],iconSize:[12,12]});t=new $.Marker({lat:r,lng:i},{draggable:!0,icon:a}).on(`moveend`,e=>o(e,n)).addTo(e)}else t&&=(t.remove(),void 0)}}function a(e){let{latlng:{lat:t,lng:n},originalEvent:{shiftKey:r}}=e;!t||!n||s(r?`Object location`:`Location`,t,n)}function o(e,t){let{lat:n,lng:r}=e.target.getLatLng();!n||!r||s(t.type,n,r)}function s(e,r,i){e===`Object location`?n.value=n.value.withLatLng(r,i).roundToPrecision():t.value=t.value.withLatLng(r,i).roundToPrecision()}return(e,t)=>(h(),E(`div`,{ref_key:`mapRef`,ref:r,class:`map h-100`,style:{"min-height":`300px`}},null,512))}}),Ge={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-search`,viewBox:`0 0 16 16`};function Ke(e,t){return h(),E(`svg`,Ge,[...t[0]||=[v(`path`,{d:`M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0`},null,-1)]])}var qe=Ke,Je={key:0,class:`row mt-3`},Ye={class:`col-sm-12`},Xe={class:`jumbotron`},Ze={key:1,class:`row mt-3`},Qe={class:`col-sm-12`},$e={class:`alert alert-warning`},et=[`innerHTML`],tt=[`innerHTML`],nt={key:2,class:`row flex-grow-1 mt-3`,style:{"--bs-gutter-x":`0.5rem`}},rt={class:`col-lg-3 col-xl-2 mt-3 mt-lg-0 h-100 col-lg-h40`,style:{"overflow-y":`scroll`,"overflow-x":`hidden`}},it={class:`progress`},at={class:`form-group`},ot={class:`checkbox`},st={class:`input-group`},ct={class:`input-group-text`},lt=[`onClick`],ut={class:`icon-link`},dt={key:0,title:`Location ✔`},ft={key:1,title:`Object location ✔`},pt={key:0,class:`col-lg-9 col-xl-3 mt-3 mt-lg-0 h-100 col-lg-h40`,style:{"overflow-y":`scroll`,"overflow-x":`hidden`}},mt={class:`row`},ht={class:`col-lg-5 col-xl-12`},gt={class:`col-lg-7 col-xl-12 mt-2`},_t={key:1,class:`col-lg-12 col-xl-7 mt-3 mt-lg-0 h-100 col-lg-h60`},vt=a(y({__name:`ltGeolocate`,setup(t){let{$query:r}=ne(),a=r.value.category,u=r.value.user,g=m(),y=m(``),x=m(!1),w=m(void 0),D=m(void 0),O=m(!1);ae(oe(),T(`Geolocate files`)),f(async()=>{O.value=!0,D.value=(await n(await i(r.value))).sort((e,t)=>e.file.localeCompare(t.file)),x.value=D.value.length<=5,w.value=j.value[0],O.value=!1}),d(w,e=>e&&F(e));function k(e){return e.coordinates.isDefinedAndSaved||e.objectLocation.isDefinedAndSaved}let j=c(()=>{let e=D.value||[];return e=x.value?e:e.filter(e=>!k(e)),e=e.filter(e=>JSON.stringify(e).includes(y.value)),e}),M=c(()=>D.value?D.value.filter(e=>k(e)):[]),N=c(()=>100*M.value.length/(D.value||[]).length);function P(e){let t=j.value,n=I(e);if(n===void 0||w.value===void 0)return;let r=n+t.indexOf(w.value);if(r>=0&&t[r]){w.value=t[r];let n=e.target;window.requestAnimationFrame(()=>n.querySelectorAll(`.list-group-item`)?.[r]?.scrollIntoView?.({block:`center`}))}}function F(t){g.value=void 0,t?.pageid&&e(t.pageid).then(e=>{Object.assign(t,e)})}function I(e){if(e&&e.key)switch(e.key){case`Right`:case`ArrowRight`:case`Down`:case`ArrowDown`:return e.preventDefault(),1;case`Left`:case`ArrowLeft`:case`Up`:case`ArrowUp`:return e.preventDefault(),-1}}let L=c(()=>T(`Fetched 0 files for category <code>{{$ctrl.category}}</code>!`).replace(`{{$ctrl.category}}`,a)),R=c(()=>T(`Fetched 0 files for user <code>{{$ctrl.user}}</code>!`).replace(`{{$ctrl.user}}`,u));return(e,t)=>(h(),E(l,null,[O.value?(h(),E(`div`,Je,[v(`div`,Ye,[v(`div`,Xe,[v(`p`,null,C(A(T)(`Loading file details …`)),1),_(ce)])])])):o(``,!0),!O.value&&!D.value?.length?(h(),E(`div`,Ze,[v(`div`,Qe,[v(`div`,$e,[_(A(Y),{class:`me-1`}),A(a)?(h(),E(`span`,{key:0,innerHTML:L.value},null,8,et)):o(``,!0),A(u)?(h(),E(`span`,{key:1,innerHTML:R.value},null,8,tt)):o(``,!0)])])])):o(``,!0),!O.value&&D.value?.length?(h(),E(`div`,nt,[v(`div`,rt,[v(`div`,it,[v(`div`,{class:`progress-bar`,role:`progressbar`,style:te({width:N.value+`%`})},C(M.value.length)+` / `+C(D.value?.length),5)]),v(`div`,at,[v(`div`,ot,[v(`label`,null,[S(v(`input`,{"onUpdate:modelValue":t[0]||=e=>x.value=e,type:`checkbox`},null,512),[[re,x.value]]),v(`span`,null,C(A(T)(`Also show geolocated files`)),1)])])]),v(`div`,st,[v(`div`,ct,[_(A(qe))]),S(v(`input`,{"onUpdate:modelValue":t[1]||=e=>y.value=e,class:`form-control`,type:`text`},null,512),[[s,y.value]])]),v(`div`,{tabindex:`1`,onKeydown:t[2]||=e=>P(e)},[_(ie,{tag:`ul`,name:`list`,class:`list-group`},{default:ee(()=>[(h(!0),E(l,null,b(j.value,e=>(h(),E(`li`,{key:e.file,class:p([`list-group-item py-1 px-2 text-truncate`,{"list-group-item-info":w.value===e}]),role:`button`,onClick:t=>w.value=e},[v(`span`,ut,[e.coordinates.isDefinedAndSaved?(h(),E(`abbr`,dt,[_(A(J))])):o(``,!0),e.objectLocation.isDefinedAndSaved?(h(),E(`abbr`,ft,[_(A(X))])):o(``,!0),v(`span`,null,C(e.file),1)])],10,lt))),128))]),_:1})],32)]),w.value?(h(),E(`div`,pt,[v(`div`,mt,[v(`div`,ht,[_(ze,{coordinates:w.value.coordinates,"onUpdate:coordinates":t[3]||=e=>w.value.coordinates=e,"object-location":w.value.objectLocation,"onUpdate:objectLocation":t[4]||=e=>w.value.objectLocation=e,file:w.value},null,8,[`coordinates`,`object-location`,`file`])]),v(`div`,gt,[_(se,{file:w.value},null,8,[`file`])])])])):o(``,!0),w.value?(h(),E(`div`,_t,[_(We,{coordinates:w.value.coordinates,"onUpdate:coordinates":t[5]||=e=>w.value.coordinates=e,"object-location":w.value.objectLocation,"onUpdate:objectLocation":t[6]||=e=>w.value.objectLocation=e},null,8,[`coordinates`,`object-location`])])):o(``,!0)])):o(``,!0)],64))}}),[[`__scopeId`,`data-v-c610fa74`]]);export{vt as default};
//# sourceMappingURL=AvxpoiLhY6j1RkiiGVk.js.map