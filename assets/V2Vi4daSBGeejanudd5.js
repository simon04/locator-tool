var e,t,n=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{},r=(e=function(e){(function(t){function n(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function r(e,t,r,i,a,o){return n((s=n(n(t,e),n(i,o)))<<(c=a)|s>>>32-c,r);var s,c}function i(e,t,n,i,a,o,s){return r(t&n|~t&i,e,t,a,o,s)}function a(e,t,n,i,a,o,s){return r(t&i|n&~i,e,t,a,o,s)}function o(e,t,n,i,a,o,s){return r(t^n^i,e,t,a,o,s)}function s(e,t,n,i,a,o,s){return r(n^(t|~i),e,t,a,o,s)}function c(e,t){var r,c,l,u,d;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var f=1732584193,p=-271733879,m=-1732584194,h=271733878;for(r=0;r<e.length;r+=16)c=f,l=p,u=m,d=h,f=i(f,p,m,h,e[r],7,-680876936),h=i(h,f,p,m,e[r+1],12,-389564586),m=i(m,h,f,p,e[r+2],17,606105819),p=i(p,m,h,f,e[r+3],22,-1044525330),f=i(f,p,m,h,e[r+4],7,-176418897),h=i(h,f,p,m,e[r+5],12,1200080426),m=i(m,h,f,p,e[r+6],17,-1473231341),p=i(p,m,h,f,e[r+7],22,-45705983),f=i(f,p,m,h,e[r+8],7,1770035416),h=i(h,f,p,m,e[r+9],12,-1958414417),m=i(m,h,f,p,e[r+10],17,-42063),p=i(p,m,h,f,e[r+11],22,-1990404162),f=i(f,p,m,h,e[r+12],7,1804603682),h=i(h,f,p,m,e[r+13],12,-40341101),m=i(m,h,f,p,e[r+14],17,-1502002290),f=a(f,p=i(p,m,h,f,e[r+15],22,1236535329),m,h,e[r+1],5,-165796510),h=a(h,f,p,m,e[r+6],9,-1069501632),m=a(m,h,f,p,e[r+11],14,643717713),p=a(p,m,h,f,e[r],20,-373897302),f=a(f,p,m,h,e[r+5],5,-701558691),h=a(h,f,p,m,e[r+10],9,38016083),m=a(m,h,f,p,e[r+15],14,-660478335),p=a(p,m,h,f,e[r+4],20,-405537848),f=a(f,p,m,h,e[r+9],5,568446438),h=a(h,f,p,m,e[r+14],9,-1019803690),m=a(m,h,f,p,e[r+3],14,-187363961),p=a(p,m,h,f,e[r+8],20,1163531501),f=a(f,p,m,h,e[r+13],5,-1444681467),h=a(h,f,p,m,e[r+2],9,-51403784),m=a(m,h,f,p,e[r+7],14,1735328473),f=o(f,p=a(p,m,h,f,e[r+12],20,-1926607734),m,h,e[r+5],4,-378558),h=o(h,f,p,m,e[r+8],11,-2022574463),m=o(m,h,f,p,e[r+11],16,1839030562),p=o(p,m,h,f,e[r+14],23,-35309556),f=o(f,p,m,h,e[r+1],4,-1530992060),h=o(h,f,p,m,e[r+4],11,1272893353),m=o(m,h,f,p,e[r+7],16,-155497632),p=o(p,m,h,f,e[r+10],23,-1094730640),f=o(f,p,m,h,e[r+13],4,681279174),h=o(h,f,p,m,e[r],11,-358537222),m=o(m,h,f,p,e[r+3],16,-722521979),p=o(p,m,h,f,e[r+6],23,76029189),f=o(f,p,m,h,e[r+9],4,-640364487),h=o(h,f,p,m,e[r+12],11,-421815835),m=o(m,h,f,p,e[r+15],16,530742520),f=s(f,p=o(p,m,h,f,e[r+2],23,-995338651),m,h,e[r],6,-198630844),h=s(h,f,p,m,e[r+7],10,1126891415),m=s(m,h,f,p,e[r+14],15,-1416354905),p=s(p,m,h,f,e[r+5],21,-57434055),f=s(f,p,m,h,e[r+12],6,1700485571),h=s(h,f,p,m,e[r+3],10,-1894986606),m=s(m,h,f,p,e[r+10],15,-1051523),p=s(p,m,h,f,e[r+1],21,-2054922799),f=s(f,p,m,h,e[r+8],6,1873313359),h=s(h,f,p,m,e[r+15],10,-30611744),m=s(m,h,f,p,e[r+6],15,-1560198380),p=s(p,m,h,f,e[r+13],21,1309151649),f=s(f,p,m,h,e[r+4],6,-145523070),h=s(h,f,p,m,e[r+11],10,-1120210379),m=s(m,h,f,p,e[r+2],15,718787259),p=s(p,m,h,f,e[r+9],21,-343485551),f=n(f,c),p=n(p,l),m=n(m,u),h=n(h,d);return[f,p,m,h]}function l(e){var t,n=``,r=32*e.length;for(t=0;t<r;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function u(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}function d(e){var t,n,r=`0123456789abcdef`,i=``;for(n=0;n<e.length;n+=1)t=e.charCodeAt(n),i+=r.charAt(t>>>4&15)+r.charAt(15&t);return i}function f(e){return unescape(encodeURIComponent(e))}function p(e){return function(e){return l(c(u(e),8*e.length))}(f(e))}function m(e,t){return function(e,t){var n,r,i=u(e),a=[],o=[];for(a[15]=o[15]=void 0,i.length>16&&(i=c(i,8*e.length)),n=0;n<16;n+=1)a[n]=909522486^i[n],o[n]=1549556828^i[n];return r=c(a.concat(u(t)),512+8*t.length),l(c(o.concat(r),640))}(f(e),f(t))}function h(e,t,n){return t?n?m(t,e):d(m(t,e)):n?p(e):d(p(e))}e.exports?e.exports=h:t.md5=h})(n)},e(t={exports:{}}),t.exports);function i(e,t){e=e.replace(/^File:/,``).replace(/\s+/g,`_`);var n=encodeURIComponent(e),i=`https://upload.wikimedia.org/wikipedia/commons`,a=r(e),o=a[0]+`/`+a[0]+a[1];return t?i+`/thumb/`+o+`/`+n+`/`+t+`px-`+n+(e.match(/tiff?$/i)?`.jpg`:e.match(/svg$/i)?`.png`:``):i+`/`+o+`/`+n}var a=class e{constructor(e,t,n,r,i){this.type=e,this.lat=t,this.lng=n,this.latOriginal=r,this.lngOriginal=i,arguments.length===3&&(this.latOriginal=t,this.lngOriginal=n)}withLatLng(t,n){return new e(this.type,t,n,this.latOriginal,this.lngOriginal)}roundToPrecision(){return new e(this.type,s(this.lat),s(this.lng),this.latOriginal,this.lngOriginal)}rollback(){return new e(this.type,this.latOriginal,this.lngOriginal)}commit(){return new e(this.type,this.lat,this.lng,this.lat,this.lng)}get isDefined(){return this.lat!==void 0&&this.lng!==void 0}get isChanged(){return this.lat!==this.latOriginal||this.lng!==this.lngOriginal}get isDefinedAndSaved(){return this.isDefined&&!this.isChanged}get csv(){return this.lat!==void 0&&this.lng!==void 0?[this.lat,this.lng].map(o).join(`, `):``}};function o(e){return e%1==0?e.toFixed(1):e}function s(e,t=5){return typeof e==`number`?+e.toFixed(t):e}const c={"*":`P625`,Location:`P1259`,"Object location":`P9149`};function l(e){return e===`__proto__`}function u(e){return typeof e==`object`&&!!e}function d(e,t,n){let r=Object.keys(t);for(let i=0;i<r.length;i++){let a=r[i];if(l(a))continue;let o=t[a],s=e[a],c=n(s,o,a,e,t);c===void 0?Array.isArray(o)?e[a]=d(s??[],o,n):u(s)&&u(o)?e[a]=d(s??{},o,n):(s===void 0||o!==void 0)&&(e[a]=o):e[a]=c}return e}async function f(e){typeof e==`string`&&(e=e.split(`|`));let t=new URL(T({prop:`coordinates`,colimit:500,coprop:`type|name`,coprimary:`all`})),n=e.reduce((e,n,r,i)=>(t.searchParams.set(`titles`,i.slice(0,r).join(`|`)),t.toString().length<2e3?e.concat(n):e),[]);if(e.length>n.length){let t=await Promise.all([f(n),f(e.slice(n.length))]);return t.flat()}t.searchParams.set(`titles`,e.join(`|`).replace(/_/g,` `));let r=await E(t),o=r?.query?.pages||{};return Object.entries(o).map(([e,t])=>({pageid:parseInt(e),file:t.title,url:`https://commons.wikimedia.org/wiki/${t.title}`,imageUrl(e){return i(this.file,e)},coordinates:new a(`Location`,...s(t.coordinates?.find(e=>e.primary===``&&e.type===`camera`))),objectLocation:new a(`Object location`,...s(t.coordinates?.find(e=>e.type===`object`)))}));function s(e){return typeof e==`object`?[e.lat,e.lon]:[void 0,void 0]}}async function p(e,t=`categories|imageinfo|revisions|wbentityusage`,n=`url|extmetadata`){let r={prop:t,pageids:e,iiprop:n,iiextmetadatafilter:`ImageDescription|Artist|DateTimeOriginal`,iiextmetadatalanguage:document.body.parentElement.lang,...t.includes(`categories`)?{clshow:`!hidden`}:{},...t.includes(`revisions`)?{rvslots:`*`,rvprop:`content`}:{}},i=await E(r),o=i?.query?.pages?.[e],s=(o?.categories||[]).map(e=>e.title.replace(/^Category:/,``)),l=o?.imageinfo[0]?.extmetadata;return{categories:s,description:l?.ImageDescription?.value,author:l?.Artist?.value,timestamp:l?.DateTimeOriginal?.value,...n.includes(`url`)?{url:o?.imageinfo[0]?.descriptionurl}:{},objectLocation:f(o),...u(o)};function u(e){let t=e?.revisions?.[0]?.slots?.mediainfo[`*`];if(!t)return{};let n=JSON.parse(t),r=d(`Location`,n.statements[c.Location]?.[0]),i=d(`Object location`,n.statements[c[`Object location`]]?.[0]);return{...r?{coordinates:r}:{},...i?{objectLocation:i}:{}}}function d(e,t){if(t?.mainsnak.datavalue?.type===`globecoordinate`)return new a(e,t?.mainsnak.datavalue.value.latitude,t?.mainsnak.datavalue.value.longitude)}function f(e){try{let t=e?.revisions?.[0]?.slots?.main[`*`]||``,n=t.match(/\{\{Object location( dec)?\|([0-9]+)\|([0-9]+)\|([0-9.]+)\|([NS])\|([0-9]+)\|([0-9]+)\|([0-9.]+)\|([WE])/i),r=t.match(/\{\{Object location( dec)?\s*\|\s*([0-9.]+)\s*\|\s*([0-9.]+)/i),i,o;return n?(i=parseInt(n[2])+parseInt(n[3])/60+parseFloat(n[4])/3600,i*=n[5]===`N`?1:-1,o=parseInt(n[6])+parseInt(n[7])/60+parseFloat(n[8])/3600,o*=n[9]===`E`?1:-1):r&&(i=parseFloat(r[2]),o=parseFloat(r[3])),new a(`Object location`,i,o)}catch{return new a(`Object location`,void 0,void 0)}}}async function m(e){let t={list:`allpages`,apnamespace:14,aplimit:30,apfrom:e,apprefix:e},n=await E(t,{},void 0,()=>!1);return(n.query.allpages||[]).map(e=>e.title.replace(/^Category:/,``))}async function h(e){let t={list:`allusers`,aulimit:30,aufrom:e,apuprefix:e},n=await E(t,{},void 0,()=>!1);return(n.query.allusers||[]).map(e=>e.name)}async function g({files:e,user:t,userLimit:n,userStart:r,userEnd:i,category:a,categoryDepth:o}){if(typeof e==`string`&&(e=e.split(`|`)),e)return e.map(e=>e.startsWith(`File:`)?e:`File:${e}`);if(t){let e=typeof n==`string`?+n:n;return y(t,e,r,i)}else if(a){let e=typeof o==`string`?+o:o;return b(a,e)}else throw Error()}async function _(e){let t={list:`geosearch`,gsnamespace:6,gslimit:500,gsprop:`type|name`,gsbbox:[e.getNorth(),e.getWest(),e.getSouth(),e.getEast()].join(`|`)},n=await E(t,{});return(n.query?.geosearch||[]).map(e=>({pageid:e.pageid,file:e.title,url:`https://commons.wikimedia.org/wiki/${e.title}`,imageUrl(e){return i(this.file,e)},coordinates:new a(`Location`,e.lat,e.lon),objectLocation:new a(`Object location`,void 0,void 0)}))}function v(e,t){return e.startsWith(`https://commons.wikimedia.org/wiki/`)&&(e=e.slice(35),e=decodeURI(e)),e.startsWith(t)&&(e=e.slice(t.length)),e}async function y(e,t,n,r){e=v(e,`User:`);let i={generator:`allimages`,gaiuser:e,gailimit:typeof t==`number`&&t<=500?t:`max`,gaistart:r?new Date(r).toISOString():void 0,gaiend:n?new Date(n).toISOString():void 0,gaisort:`timestamp`,gaidir:`older`},a=e=>Object.values(e.query.pages),o=e=>e.continue?!t||a(e).length<t:!1,s=await E(i,{},void 0,o),c=a(s).map(e=>e.title);return t?c.slice(0,t):c}async function b(e,t=3){e=v(e,`Category:`);let n=new AbortController,r=[S(e,t,n.signal),C(e,t,n.signal),w(e,t,n.signal)];t<=0&&r.unshift(x(e,n.signal));try{return await new Promise((t,n)=>{for(let n of r)n.then(t,t=>{t instanceof DOMException&&t.name===`AbortError`||console.warn(`Error fetching category`,e,t)});Promise.allSettled(r).catch(n)})}finally{n.abort()}}async function x(e,t){let n={list:`categorymembers`,cmlimit:500,cmnamespace:6,cmtitle:`Category:`+e},r=await E(n,{},t);return(r.query.categorymembers||[]).map(e=>e.title)}async function S(e,t,n){let r={lang:`commons`,cat:e.replace(/^Category:/,``),type:6,depth:t,json:1},i=`https://cats-php.toolforge.org/?`+D(r),a=await O(i,{signal:n});return a.map(e=>`File:${e}`)}async function C(e,t,n){let r={category:e.replace(/^Category:/,``),ns:6,depth:t},i=`/catscan?`+D(r),a=await O(i,{signal:n});return a.pages.map(e=>`File:${e}`)}async function w(e,t,n){let r={language:`commons`,project:`wikimedia`,depth:t,categories:e,"ns[6]":1,format:`json`,sparse:1,doit:1},i=`https://petscan.wmcloud.org/?`+D(r),a=await O(i,{signal:n});return a[`*`][0].a[`*`]}function T(e={}){let t={action:`query`,format:`json`,origin:`*`,...e},n=`https://commons.wikimedia.org/w/api.php?`+D(t);return n}async function E(e,t={},n,r=e=>!!e.continue){let i=e instanceof URL?e.toString():T(e),a=await O(i,{signal:n});return a=d(t,a,(e,t)=>{if(Array.isArray(e)&&Array.isArray(t))return[].concat(...e,...t)}),r(a)?E({...e,continue:void 0,...a.continue},{...a,continue:void 0},n,r):a}function D(e){let t=new URLSearchParams;for(let[n,r]of Object.entries(e)){if(r===void 0)continue;t.append(n,String(r))}return t}async function O(e,t){console.log(`Fetching`,e);let n=await fetch(e,{cache:`no-cache`,headers:{Accept:`application/json`},...t});if(n.ok)return n.json();throw Error(n.statusText)}var k=(e,t)=>{let n=e.__vccOpts||e;for(let[e,r]of t)n[e]=r;return n};export{k as b,_ as c,m as d,f as e,p as f,g,h,a as i};
//# sourceMappingURL=V2Vi4daSBGeejanudd5.js.map