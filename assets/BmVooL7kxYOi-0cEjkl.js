import{D as e,G as t,I as n,J as r,R as i,S as a,b as o,j as s,q as c,s as l}from"./index-ByJQWOIH.js";import{b as u,c as d}from"./CE8RnE936nnC2fhCrWr.js";import{b as f,c as p,g as m}from"./CAGvK2Y1ndSEpwzkddz.js";import{b as h,c as g,e as _,f as v,g as y}from"./V2Vi4daSBGeejanudd5.js";import"./DpPv6a51Uoo6Dmn-RmS.js";import{b}from"./V_7Agfg7qM7lHrMXRho.js";var x=t({__name:`ltAllMap`,setup(t){let{$query:h,hasFilesUserCategory:x}=o(),S=c(),C=a(null);d(u(),s(`Map`)),n(async()=>{let{map:e}=f(C);if(x.value){let t=await y(h.value),n=await _(t),r=n.flatMap(t=>{let n=T(t);return n?.addTo(e),n?[n.getLatLng()]:[]});e.fitBounds(r)}else w(e),e.on(`moveend`,()=>w(e)),e.on(`zoomend`,()=>w(e))});async function w(e){let t=await g(e.getBounds());e.eachLayer(t=>{t instanceof p&&!t.isPopupOpen()&&e.removeLayer(t)}),t.forEach(t=>T(t)?.addTo(e))}function T(e){if(!e.coordinates.isDefined)return;let{lat:t,lng:n}=e.coordinates;return new p({lat:t,lng:n},{color:`#2a4b8d`}).bindTooltip(e.file).bindPopup(E(e))}function E(e){let t,n,r=new m({minWidth:400});return r.setContent(()=>(e=i(e),e.$geolocate=S.resolve({name:`geolocate`,query:{files:e.file}}).href,t=l(b,{title:e}),v(e.pageid,`categories|imageinfo`,`extmetadata`).then(t=>{Object.assign(e,t)}),n=document.createElement(`div`),n)),r.on(`add`,()=>t.mount(n)),r.on(`remove`,()=>t.unmount()),r}return(t,n)=>(r(),e(`div`,{ref_key:`mapRef`,ref:C,class:`map h-100`,style:{"min-height":`300px`}},null,512))}}),S=h(x,[[`__scopeId`,`data-v-6f7dbbfe`]]);export{S as default};
//# sourceMappingURL=BmVooL7kxYOi-0cEjkl.js.map