import{A as e,B as t,C as n,D as r,E as i,F as a,G as o,H as s,I as c,J as l,K as u,N as d,O as f,P as p,Q as m,S as h,T as g,U as _,V as v,W as y,b,g as x,j as S,l as C,p as w,r as T,t as E,v as D,w as O,y as k,z as A}from"./index-ByJQWOIH.js";import{b as j,c as ee}from"./CE8RnE936nnC2fhCrWr.js";import{b as M,d as N,e as P,f as F}from"./CAGvK2Y1ndSEpwzkddz.js";import{b as I,e as te,f as ne,g as re,i as L}from"./V2Vi4daSBGeejanudd5.js";import{b as ie,c as R,f as z}from"./DpPv6a51Uoo6Dmn-RmS.js";import{b as ae}from"./CckgnFV4TVywy2d5WAr.js";const B={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-save`,viewBox:`0 0 16 16`};function V(t,n){return l(),r(`svg`,B,[...n[0]||=[e(`path`,{d:`M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1z`},null,-1)]])}var H=V;const oe={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-x-square`,viewBox:`0 0 16 16`};function se(t,n){return l(),r(`svg`,oe,[...n[0]||=[e(`path`,{d:`M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z`},null,-1),e(`path`,{d:`M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708`},null,-1)]])}var ce=se;const U={class:`input-group`},W=[`value`],G=[`title`],le=[`title`,`disabled`];var ue=o({__name:`ltLocationInput`,props:{modelValue:{required:!0},modelModifiers:{}},emits:s([`editLocation`],[`update:modelValue`]),setup(t,{emit:n}){let i=/(?<lat>[+-]?\d+\.?\d*)(_(?<ns>[NS]))?[_,;\s]+(?<lng>[+-]?\d+\.?\d*)(_(?<ew>[EW]))?/,o=d(t,`modelValue`),s=n,c=h(o.value?.type),u=h(null);function f(e){if(e===void 0)return;if(!c.value){let e=o.value?.type;e&&(c.value=e)}let t=e.match(i),n=!!t||!e;u.value?.classList?.toggle(`is-invalid`,!n),n&&(o.value=new L(c.value,t?.groups?parseFloat(t.groups.lat)*(t.groups.ns===`S`?-1:1):void 0,t?.groups?parseFloat(t.groups.lng)*(t.groups.ew===`W`?-1:1):void 0,o.value.lat,o.value.lng))}function p(){o.value=o.value?.rollback()}return(t,n)=>(l(),r(`div`,U,[e(`input`,{ref_key:`inputElement`,ref:u,value:o.value.csv,class:`form-control`,type:`text`,onBlur:n[0]||=e=>f(e.target.value),onPaste:n[1]||=e=>{f(e.clipboardData?.getData(`text`)),e.preventDefault()}},null,40,W),e(`button`,{class:`btn btn-outline-secondary`,type:`button`,title:g(S)(`Discard`),onClick:n[2]||=e=>p()},[a(g(ce))],8,G),e(`button`,{class:`btn btn-outline-success`,type:`button`,title:g(S)(`Save`),disabled:!o.value?.isChanged,onClick:n[3]||=e=>s(`editLocation`)},[a(g(H))],8,le)]))}}),K=ue;const de={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-caret-down`,viewBox:`0 0 16 16`};function fe(t,n){return l(),r(`svg`,de,[...n[0]||=[e(`path`,{d:`M3.204 5h9.592L8 10.481zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659`},null,-1)]])}var q=fe;const pe={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-caret-right`,viewBox:`0 0 16 16`};function me(t,n){return l(),r(`svg`,pe,[...n[0]||=[e(`path`,{d:`M6 12.796V3.204L11.481 8zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753`},null,-1)]])}var J=me;const he={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-camera-fill`,viewBox:`0 0 16 16`};function ge(t,n){return l(),r(`svg`,he,[...n[0]||=[e(`path`,{d:`M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0`},null,-1),e(`path`,{d:`M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0`},null,-1)]])}var Y=ge;const _e={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-exclamation-triangle-fill`,viewBox:`0 0 16 16`};function ve(t,n){return l(),r(`svg`,_e,[...n[0]||=[e(`path`,{d:`M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2`},null,-1)]])}var X=ve;const ye={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-house-fill`,viewBox:`0 0 16 16`};function be(t,n){return l(),r(`svg`,ye,[...n[0]||=[e(`path`,{d:`M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z`},null,-1),e(`path`,{d:`m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z`},null,-1)]])}var Z=be;const xe={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-question-circle`,viewBox:`0 0 16 16`};function Se(t,n){return l(),r(`svg`,xe,[...n[0]||=[e(`path`,{d:`M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16`},null,-1),e(`path`,{d:`M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94`},null,-1)]])}var Q=Se;const Ce=[`disabled`],we={class:`icon-link`},Te={key:0},Ee={key:1},De={class:`card mt-2`},Oe={class:`card-body p-2`},ke=[`innerHTML`],Ae=[`title`],je={class:`card mt-2`},Me={class:`card-body p-2`},Ne=[`innerHTML`],Pe=[`title`],Fe={key:0,class:`alert alert-danger mt-2`},Ie={class:`card mt-2`},Le={class:`card-header p-2`},Re={key:0},ze=[`href`],Be={class:`card-body p-2`};var Ve=o({__name:`ltFileDetails`,props:s({file:{}},{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}}),emits:[`update:coordinates`,`update:objectLocation`],setup(o){let s=d(o,`coordinates`),c=d(o,`objectLocation`),u=o,f=h(void 0),p=h(!1),_=h(!1),v=A(()=>S(`Camera location via
<a href="https://commons.wikimedia.org/wiki/Template:Location" target="_blank"><code class="mediawiki-template">Location</code></a>`)),b=A(()=>S(`Object location via
<a href="https://commons.wikimedia.org/wiki/Template:Object_location" target="_blank"><code class="mediawiki-template">Object location</code></a>`)),T=A(()=>S(`Failed to save: {{$ctrl.error.statusText}}`).replace(`{{$ctrl.error.statusText}}`,f.value?.statusText)),E=A(()=>navigator.platform.toUpperCase().includes(`MAC`)),D=C({passive:!1,onEventFired(e){e.type===`keydown`&&e.key===`s`&&(e.ctrlKey||e.metaKey)&&e.preventDefault()}});w(D[`Ctrl+S`],()=>j()),w(D[`Meta+S`],()=>j());async function j(e){e??=[s.value,c.value].filter(e=>e.isChanged);try{f.value=void 0,await x(u.file,e);for(let t of e)t.type===`Location`?s.value=t.commit():t.type===`Object location`&&(c.value=t.commit())}catch(e){f.value=e}}return(o,u)=>(l(),r(k,null,[e(`button`,{class:`btn btn-success form-control`,type:`button`,disabled:!(s.value?.isChanged||c.value?.isChanged),onClick:u[0]||=e=>j()},[e(`span`,we,[a(g(H)),i(` `+y(g(S)(`Save`))+` `,1),E.value?(l(),r(`kbd`,Te,`âŒ˜ + S`)):(l(),r(`kbd`,Ee,`Ctrl + S`))])],8,Ce),e(`div`,De,[e(`div`,Oe,[e(`div`,null,[e(`label`,{class:`icon-link`,onClick:u[1]||=e=>p.value=!p.value},[p.value?(l(),t(g(J),{key:0})):(l(),t(g(q),{key:1})),a(g(Y)),e(`span`,{innerHTML:v.value},null,8,ke),m(e(`abbr`,{title:g(S)(`Left click on map to set the location.`)},[a(g(Q))],8,Ae),[[O,!p.value]])]),m(e(`div`,null,[a(K,{modelValue:s.value,"onUpdate:modelValue":u[2]||=e=>s.value=e,onEditLocation:u[3]||=e=>j([s.value])},null,8,[`modelValue`])],512),[[O,!p.value]])])])]),e(`div`,je,[e(`div`,Me,[e(`div`,null,[e(`label`,{class:`icon-link`,onClick:u[4]||=e=>_.value=!_.value},[_.value?(l(),t(g(J),{key:0})):(l(),t(g(q),{key:1})),a(g(Z)),e(`span`,{innerHTML:b.value},null,8,Ne),m(e(`abbr`,{title:g(S)(`Press shift and click on map to set the object location.`)},[a(g(Q))],8,Pe),[[O,!_.value]])]),m(e(`div`,null,[a(K,{modelValue:c.value,"onUpdate:modelValue":u[5]||=e=>c.value=e,onEditLocation:u[6]||=e=>j([c.value])},null,8,[`modelValue`])],512),[[O,!_.value]])])])]),f.value?(l(),r(`div`,Fe,[a(g(X),{class:`me-1`}),e(`span`,null,y(T.value),1)])):n(``,!0),e(`div`,Ie,[e(`h5`,Le,[e(`strong`,null,y(o.file.file),1),u[7]||=i(` `+y(` `)+` `,-1),o.file.url?(l(),r(`small`,Re,[e(`a`,{href:o.file.url,target:`_blank`},[a(g(z))],8,ze)])):n(``,!0)]),e(`div`,Be,[a(R,{file:o.file},null,8,[`file`])])])],64))}}),He=Ve,Ue=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
  <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
  <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
</svg>`,We=`/assets/marker-icon-2x-_ZA0WGCc.png`,Ge=`/assets/marker-icon-hN30_KVU.png`,Ke=`/assets/marker-shadow-f7SaPCxT.png`,qe=o({__name:`ltMap`,props:{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}},emits:s([`mapViewChanged`],[`update:coordinates`,`update:objectLocation`]),setup(e){let t=d(e,`coordinates`),n=d(e,`objectLocation`),i=h(null);c(()=>{let{map:e}=M(i);e.on(`click`,e=>o(e)),f(t,a(e),{immediate:!0}),f(n,a(e),{immediate:!0})});function a(e){let t;return n=>{let{lat:r,lng:i}=n;if(n.isDefined&&t)e.setView({lat:r,lng:i}),t.setLatLng({lat:r,lng:i});else if(n.isDefined){e.setView({lat:r,lng:i});let a=n.type===`Location`?new P({iconRetinaUrl:We,iconUrl:Ge,shadowUrl:Ke,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]}):new N({className:`b-0`,html:`<div title="Object location" style="color: red">${Ue}</div>`,iconAnchor:[6,6],iconSize:[12,12]});t=new F({lat:r,lng:i},{draggable:!0,icon:a}).on(`moveend`,e=>s(e,n)).addTo(e)}else t&&=(t.remove(),void 0)}}function o(e){let{latlng:{lat:t,lng:n},originalEvent:{shiftKey:r}}=e;!t||!n||u(r?`Object location`:`Location`,t,n)}function s(e,t){let{lat:n,lng:r}=e.target.getLatLng();!n||!r||u(t.type,n,r)}function u(e,r,i){e===`Object location`?n.value=n.value.withLatLng(r,i).roundToPrecision():t.value=t.value.withLatLng(r,i).roundToPrecision()}return(e,t)=>(l(),r(`div`,{ref_key:`mapRef`,ref:i,class:`map h-100`,style:{"min-height":`300px`}},null,512))}}),Je=qe;const Ye={xmlns:`http://www.w3.org/2000/svg`,width:`16`,height:`16`,fill:`currentColor`,class:`bi bi-search`,viewBox:`0 0 16 16`};function Xe(t,n){return l(),r(`svg`,Ye,[...n[0]||=[e(`path`,{d:`M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0`},null,-1)]])}var Ze=Xe;const Qe={key:0,class:`row mt-3`},$e={class:`col-sm-12`},et={class:`jumbotron`},tt={key:1,class:`row mt-3`},nt={class:`col-sm-12`},rt={class:`alert alert-warning`},it=[`innerHTML`],at=[`innerHTML`],ot={key:2,class:`row flex-grow-1 mt-3`,style:{"--bs-gutter-x":`0.5rem`}},st={class:`col-lg-3 col-xl-2 mt-3 mt-lg-0 h-100 col-lg-h40`,style:{"overflow-y":`scroll`,"overflow-x":`hidden`}},ct={class:`progress`},lt={class:`form-group`},ut={class:`checkbox`},dt={class:`input-group`},ft={class:`input-group-text`},$=[`onClick`],pt={class:`icon-link`},mt={key:0,title:`Location âœ”`},ht={key:1,title:`Object location âœ”`},gt={key:0,class:`col-lg-9 col-xl-3 mt-3 mt-lg-0 h-100 col-lg-h40`,style:{"overflow-y":`scroll`,"overflow-x":`hidden`}},_t={class:`row`},vt={class:`col-lg-5 col-xl-12`},yt={class:`col-lg-7 col-xl-12 mt-2`},bt={key:1,class:`col-lg-12 col-xl-7 mt-3 mt-lg-0 h-100 col-lg-h60`};var xt=o({__name:`ltGeolocate`,setup(t){let{$query:i}=b(),o=i.value.category,s=i.value.user,d=h(),x=h(``),C=h(!1),w=h(void 0),O=h(void 0),M=h(!1);ee(j(),S(`Geolocate files`)),c(async()=>{M.value=!0;let e=await re(i.value),t=await te(e);O.value=t.sort((e,t)=>e.file.localeCompare(t.file)),C.value=O.value.length<=5,w.value=P.value[0],M.value=!1}),f(w,e=>e&&R(e));function N(e){return e.coordinates.isDefinedAndSaved||e.objectLocation.isDefinedAndSaved}let P=A(()=>{let e=O.value||[];return e=C.value?e:e.filter(e=>!N(e)),e=e.filter(e=>JSON.stringify(e).includes(x.value)),e}),F=A(()=>O.value?O.value.filter(e=>N(e)):[]),I=A(()=>100*F.value.length/(O.value||[]).length);function L(e){let t=P.value,n=z(e);if(n===void 0||w.value===void 0)return;let r=t.indexOf(w.value),i=n+r;if(i>=0&&t[i]){w.value=t[i];let n=e.target;window.requestAnimationFrame(()=>n.querySelectorAll(`.list-group-item`)?.[i]?.scrollIntoView?.({block:`center`}))}}function R(e){d.value=void 0,e?.pageid&&ne(e.pageid).then(t=>{Object.assign(e,t)})}function z(e){if(e&&e.key)switch(e.key){case`Right`:case`ArrowRight`:case`Down`:case`ArrowDown`:return e.preventDefault(),1;case`Left`:case`ArrowLeft`:case`Up`:case`ArrowUp`:return e.preventDefault(),-1}}let B=A(()=>S(`Fetched 0 files for category <code>{{$ctrl.category}}</code>!`).replace(`{{$ctrl.category}}`,o)),V=A(()=>S(`Fetched 0 files for user <code>{{$ctrl.user}}</code>!`).replace(`{{$ctrl.user}}`,s));return(t,i)=>(l(),r(k,null,[M.value?(l(),r(`div`,Qe,[e(`div`,$e,[e(`div`,et,[e(`p`,null,y(g(S)(`Loading file details â€¦`)),1),a(ae)])])])):n(``,!0),!M.value&&!O.value?.length?(l(),r(`div`,tt,[e(`div`,nt,[e(`div`,rt,[a(g(X),{class:`me-1`}),g(o)?(l(),r(`span`,{key:0,innerHTML:B.value},null,8,it)):n(``,!0),g(s)?(l(),r(`span`,{key:1,innerHTML:V.value},null,8,at)):n(``,!0)])])])):n(``,!0),!M.value&&O.value?.length?(l(),r(`div`,ot,[e(`div`,st,[e(`div`,ct,[e(`div`,{class:`progress-bar`,role:`progressbar`,style:v({width:I.value+`%`})},y(F.value.length)+` / `+y(O.value?.length),5)]),e(`div`,lt,[e(`div`,ut,[e(`label`,null,[m(e(`input`,{"onUpdate:modelValue":i[0]||=e=>C.value=e,type:`checkbox`},null,512),[[E,C.value]]),e(`span`,null,y(g(S)(`Also show geolocated files`)),1)])])]),e(`div`,dt,[e(`div`,ft,[a(g(Ze))]),m(e(`input`,{"onUpdate:modelValue":i[1]||=e=>x.value=e,class:`form-control`,type:`text`},null,512),[[D,x.value]])]),e(`div`,{tabindex:`1`,onKeydown:i[2]||=e=>L(e)},[a(T,{tag:`ul`,name:`list`,class:`list-group`},{default:p(()=>[(l(!0),r(k,null,u(P.value,t=>(l(),r(`li`,{key:t.file,class:_([`list-group-item py-1 px-2 text-truncate`,{"list-group-item-info":w.value===t}]),role:`button`,onClick:e=>w.value=t},[e(`span`,pt,[t.coordinates.isDefinedAndSaved?(l(),r(`abbr`,mt,[a(g(Y))])):n(``,!0),t.objectLocation.isDefinedAndSaved?(l(),r(`abbr`,ht,[a(g(Z))])):n(``,!0),e(`span`,null,y(t.file),1)])],10,$))),128))]),_:1})],32)]),w.value?(l(),r(`div`,gt,[e(`div`,_t,[e(`div`,vt,[a(He,{coordinates:w.value.coordinates,"onUpdate:coordinates":i[3]||=e=>w.value.coordinates=e,"object-location":w.value.objectLocation,"onUpdate:objectLocation":i[4]||=e=>w.value.objectLocation=e,file:w.value},null,8,[`coordinates`,`object-location`,`file`])]),e(`div`,yt,[a(ie,{file:w.value},null,8,[`file`])])])])):n(``,!0),w.value?(l(),r(`div`,bt,[a(Je,{coordinates:w.value.coordinates,"onUpdate:coordinates":i[5]||=e=>w.value.coordinates=e,"object-location":w.value.objectLocation,"onUpdate:objectLocation":i[6]||=e=>w.value.objectLocation=e},null,8,[`coordinates`,`object-location`])])):n(``,!0)])):n(``,!0)],64))}}),St=I(xt,[[`__scopeId`,`data-v-a63eff0d`]]);export{St as default};
//# sourceMappingURL=CRyydqBq1m1fyAJP14I.js.map