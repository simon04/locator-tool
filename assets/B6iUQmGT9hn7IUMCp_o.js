import{a as e,c as t,i as n,l as r,n as i,o as a,t as o}from"./BXKdr608ngUESnwh9TJ.js";import{G as s,I as c,K as l,L as u,P as d,b as f,d as p,j as m,t as h,v as g}from"./index-DKeDeMIW.js";import{n as _,t as v}from"./KBQiTbN6CMsyITC2uY1.js";import{t as y}from"./BHncciX3sAO02PSaJXe.js";import"./BkWEt4jxc2Oj2teMzcr.js";import{t as b}from"./BG2riEz0ooTYCXUva1I.js";var x=r(t(),1),S=o(d({__name:`ltAllMap`,setup(t){let{$query:r,hasFilesUserCategory:o}=h(),d=g(),S=l(null);_(v(),p(`Map`)),c(async()=>{let{map:e}=y(S);if(o.value){let t=(await n(await a(r.value))).flatMap(t=>{let n=w(t);return n?.addTo(e),n?[n.getLatLng()]:[]});e.fitBounds(t)}else C(e),e.on(`moveend`,()=>C(e)),e.on(`zoomend`,()=>C(e))});async function C(e){let t=await i(e.getBounds());e.eachLayer(t=>{t instanceof x.CircleMarker&&!t.isPopupOpen()&&e.removeLayer(t)}),t.forEach(t=>w(t)?.addTo(e))}function w(e){if(!e.coordinates.isDefined)return;let{lat:t,lng:n}=e.coordinates;return new x.CircleMarker({lat:t,lng:n},{color:`#2a4b8d`}).bindTooltip(e.file).bindPopup(T(e))}function T(t){let n,r,i=new x.Popup({minWidth:400});return i.setContent(()=>(t=s(t),t.$geolocate=d.resolve({name:`geolocate`,query:{files:t.file}}).href,n=f(b,{title:t}),e(t.pageid,`categories|imageinfo`,`extmetadata`).then(e=>{Object.assign(t,e)}),r=document.createElement(`div`),r)),i.on(`add`,()=>n.mount(r)),i.on(`remove`,()=>n.unmount()),i}return(e,t)=>(u(),m(`div`,{ref_key:`mapRef`,ref:S,class:`map h-100`,style:{"min-height":`300px`}},null,512))}}),[[`__scopeId`,`data-v-b1d73674`]]);export{S as default};
//# sourceMappingURL=B6iUQmGT9hn7IUMCp_o.js.map